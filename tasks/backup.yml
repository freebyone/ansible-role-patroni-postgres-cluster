- name: Create backup script
  template:
    src: backup-script.sh.j2
    dest: "{{ postgres_backup_script_path }}/postgres-backup.sh"
    owner: "postgres"
    group: "postgres"
    mode: '0750'
  when: backup_enabled

- name: Configure cron job for backups
  cron:
    name: "PostgreSQL backup"
    job: "{{ postgres_backup_script_path }}/postgres-backup.sh >> /var/log/postgres-backup.log 2>&1"
    minute: "0"
    hour: "2"
    user: "postgres"
  when: backup_enabled